{"schemaVersion":{"major":0,"minor":3,"patch":0},"sections":[],"hierarchy":{"paths":[["doc:\/\/Logging\/documentation\/swift-log"]]},"kind":"article","metadata":{"modules":[{"name":"swift-log"}],"roleHeading":"Article","role":"article","title":"SLG-0002: Compile-time log level elimination using traits"},"abstract":[{"text":"Enable compile-time elimination of log levels to achieve zero runtime overhead for logs that will never be needed in production.","type":"text"}],"primaryContentSections":[{"content":[{"level":2,"text":"Overview","anchor":"Overview","type":"heading"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Proposal: SLG-0002"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Author(s): ","type":"text"},{"identifier":"https:\/\/github.com\/kukushechkin","isActive":true,"type":"reference"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Status: "},{"type":"strong","inlineContent":[{"text":"Ready for Implementation","type":"text"}]}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Issue: "},{"type":"reference","identifier":"https:\/\/github.com\/apple\/swift-log\/issues\/378","isActive":true}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Implementation:"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"reference","isActive":true,"identifier":"https:\/\/github.com\/apple\/swift-log\/pull\/389"}],"type":"paragraph"}]}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Related links:"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"identifier":"https:\/\/github.com\/apple\/swift-log\/blob\/main\/Sources\/Logging\/Docs.docc\/Proposals\/Proposals.md","type":"reference","isActive":true}]}]}],"type":"unorderedList"}]}]},{"level":3,"text":"Introduction","anchor":"Introduction","type":"heading"},{"inlineContent":[{"type":"text","text":"Add Swift package traits to allow applications to compile out less severe log levels, completely eliminating their runtime overhead from the final binary."}],"type":"paragraph"},{"level":3,"text":"Motivation","anchor":"Motivation","type":"heading"},{"inlineContent":[{"type":"text","text":"In production deployments, applications often know in advance which log levels will never be needed. For example, a production service typically only needs warning and above, while trace and debug levels are exclusively useful during development. Currently, even with the log level set to "},{"type":"codeVoice","code":".warning"},{"type":"text","text":" at runtime, the code for trace and debug statements still exists in the binary and incurs overhead."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"For performance-critical applications or resource-constrained environments, this overhead is unacceptable. Applications need a way to completely remove unnecessary log levels at compile time, achieving zero runtime cost."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"Before this proposal, the only workarounds were:"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"Manually wrapping log statements in ","type":"text"},{"code":"#if DEBUG","type":"codeVoice"},{"text":" checks (error-prone and verbose)","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Accepting the runtime overhead (unacceptable for many use cases)","type":"text"}]}]}]},{"level":3,"text":"Proposed solution","anchor":"Proposed-solution","type":"heading"},{"inlineContent":[{"type":"text","text":"This proposal introduces seven package traits that correspond to maximum log level thresholds. Applications specify a trait when declaring their dependency on SwiftLog, and all less severe log levels are completely compiled out."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"In your ","type":"text"},{"code":"Package.swift","type":"codeVoice"},{"text":":","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["dependencies: [","    .package(","        url: \"https:\/\/github.com\/apple\/swift-log.git\",","        from: \"1.0.0\",","        traits: [\"MaxLogLevelWarning\"]","    )","]"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"With "},{"type":"codeVoice","code":"MaxLogLevelWarning"},{"type":"text","text":" enabled:"}]},{"type":"codeListing","syntax":"swift","code":["\/\/ These become no-ops (compiled out completely):","logger.trace(\"This will not be in the binary\")","logger.debug(\"This will not be in the binary\")","logger.info(\"This will not be in the binary\")","logger.notice(\"This will not be in the binary\")","logger.log(level: .debug, \"This will not log anything\")","","\/\/ These work normally:","logger.warning(\"This still works\")","logger.error(\"This still works\")","logger.critical(\"This still works\")","logger.log(level: .error, \"This still works\")"]},{"level":3,"text":"Detailed design","type":"heading","anchor":"Detailed-design"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The seven available traits, ordered from most permissive to most restrictive, are:"}]},{"type":"codeListing","syntax":"swift","code":["traits: [","    .trait(name: \"MaxLogLevelDebug\", description: \"Debug and above available (compiles out trace)\"),","    .trait(name: \"MaxLogLevelInfo\", description: \"Info and above available (compiles out trace, debug)\"),","    .trait(name: \"MaxLogLevelNotice\", description: \"Notice and above available (compiles out trace, debug, info)\"),","    .trait(","        name: \"MaxLogLevelWarning\",","        description: \"Warning and above available (compiles out trace, debug, info, notice)\"","    ),","    .trait(","        name: \"MaxLogLevelError\",","        description: \"Error and above available (compiles out trace, debug, info, notice, warning)\"","    ),","    .trait(name: \"MaxLogLevelCritical\", description: \"Only critical available (compiles out all except critical)\"),","    .trait(name: \"MaxLogLevelNone\", description: \"All logging compiled out (no log levels available)\"),","","    .default(enabledTraits: []),","]"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"By default (when no traits are specified), all log levels remain available."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Traits are additive: if multiple max level traits are specified in the dependency graph, the most restrictive one takes effect. This ensures that if any dependency requests stricter elimination, the entire build respects it."}]},{"name":"Important","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Traits should only be set by applications, not libraries, as any trait defined in a transitive dependency will affect the entire dependency resolution tree."}]}],"type":"aside","style":"important"},{"type":"paragraph","inlineContent":[{"text":"For the generic ","type":"text"},{"code":"log(level:)","type":"codeVoice"},{"text":" method, the implementation switches behavior based on whether any trait is enabled:","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["public func log(","    level: Logger.Level,","    _ message: @autoclosure () -> Logger.Message,","    metadata: @autoclosure () -> Logger.Metadata? = nil,","    source: @autoclosure () -> String? = nil,","    file: String = #fileID,","    function: String = #function,","    line: UInt = #line",") {","    #if MaxLogLevelDebug || MaxLogLevelInfo || MaxLogLevelNotice || MaxLogLevelWarning || MaxLogLevelError || MaxLogLevelCritical || MaxLogLevelNone","    \/\/ When traits are enabled, dispatch to level-specific methods","    \/\/ to leverage their compile-time elimination","    switch level {","    case .trace:","        self.trace(message(), metadata: metadata(), source: source(), file: file, function: function, line: line)","    case .debug:","        self.debug(message(), metadata: metadata(), source: source(), file: file, function: function, line: line)","    \/\/ ... (all levels)","    }","    #else","    \/\/ When no traits are enabled, avoid the switch overhead","    self._log(","        level: level,","        message(),","        metadata: metadata(),","        source: source(),","        file: file,","        function: function,","        line: line","    )","    #endif","}"]},{"type":"paragraph","inlineContent":[{"text":"This approach adds a minimal switch statement overhead when traits are enabled, but allows the level-specific methodsâ€™ compile-time elimination to work even when called through ","type":"text"},{"code":"log(level:)","type":"codeVoice"},{"text":". When no traits are enabled, the original zero-overhead path is preserved. Level-specific methods has no additional overhead.","type":"text"}]},{"level":3,"text":"API stability","type":"heading","anchor":"API-stability"},{"type":"paragraph","inlineContent":[{"inlineContent":[{"type":"text","text":"For existing "},{"type":"codeVoice","code":"Logger"},{"type":"text","text":" users:"}],"type":"strong"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"When no traits are enabled (the default), behavior is identical to before","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Users can opt in to traits at the application level without modifying any source code"}]}]}]},{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"text":"For existing ","type":"text"},{"type":"codeVoice","code":"LogHandler"},{"text":" implementations:","type":"text"}]}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"No changes are required to any "},{"type":"codeVoice","code":"LogHandler"},{"type":"text","text":" implementation"}]}]}]},{"level":3,"text":"Future directions","type":"heading","anchor":"Future-directions"},{"type":"paragraph","inlineContent":[{"type":"text","text":"No future directions identified."}]},{"level":3,"text":"Alternatives considered","type":"heading","anchor":"Alternatives-considered"},{"level":4,"text":"Per-log-level traits","type":"heading","anchor":"Per-log-level-traits"},{"type":"paragraph","inlineContent":[{"type":"text","text":"An alternative approach would be to define one trait per log level that could be individually disabled:"}]},{"type":"codeListing","syntax":"swift","code":["traits: [","    .trait(name: \"DisableTraceLogs\"),","    .trait(name: \"DisableDebugLogs\"),","    .trait(name: \"DisableInfoLogs\"),","    .trait(name: \"DisableNoticeLogs\"),","    .trait(name: \"DisableWarningLogs\"),","    .trait(name: \"DisableErrorLogs\"),","    .trait(name: \"DisableCriticalLogs\"),","]"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Users would specify multiple traits to eliminate multiple levels:"}]},{"type":"codeListing","syntax":"swift","code":[".package(","    url: \"https:\/\/github.com\/apple\/swift-log.git\",","    from: \"1.0.0\",","    traits: [\"DisableTraceLogs\", \"DisableDebugLogs\", \"DisableInfoLogs\", \"DisableNoticeLogs\"]",")"]},{"type":"paragraph","inlineContent":[{"text":"This approach was rejected in favor of a ","type":"text"},{"code":"MaxLogLevel","type":"codeVoice"},{"text":" semantics to make it less verbose to use the functionality and to be aligned with the similar functionality in logging packages in other languages users might already be familiar with.","type":"text"}]}],"kind":"content"}],"variants":[{"paths":["\/documentation\/logging\/slg-0002"],"traits":[{"interfaceLanguage":"swift"}]}],"identifier":{"url":"doc:\/\/Logging\/documentation\/Logging\/SLG-0002","interfaceLanguage":"swift"},"references":{"doc://Logging/documentation/swift-log":{"role":"collection","abstract":[],"url":"\/documentation\/swift-log","title":"swift-log","identifier":"doc:\/\/Logging\/documentation\/swift-log","type":"topic","kind":"symbol"},"https://github.com/apple/swift-log/issues/378":{"identifier":"https:\/\/github.com\/apple\/swift-log\/issues\/378","url":"https:\/\/github.com\/apple\/swift-log\/issues\/378","type":"link","title":"apple\/swift-log#378","titleInlineContent":[{"text":"apple\/swift-log#378","type":"text"}]},"https://github.com/apple/swift-log/blob/main/Sources/Logging/Docs.docc/Proposals/Proposals.md":{"identifier":"https:\/\/github.com\/apple\/swift-log\/blob\/main\/Sources\/Logging\/Docs.docc\/Proposals\/Proposals.md","url":"https:\/\/github.com\/apple\/swift-log\/blob\/main\/Sources\/Logging\/Docs.docc\/Proposals\/Proposals.md","type":"link","title":"Lightweight proposals process description","titleInlineContent":[{"text":"Lightweight proposals process description","type":"text"}]},"https://github.com/apple/swift-log/pull/389":{"identifier":"https:\/\/github.com\/apple\/swift-log\/pull\/389","url":"https:\/\/github.com\/apple\/swift-log\/pull\/389","type":"link","title":"apple\/swift-log#389","titleInlineContent":[{"text":"apple\/swift-log#389","type":"text"}]},"https://github.com/kukushechkin":{"identifier":"https:\/\/github.com\/kukushechkin","url":"https:\/\/github.com\/kukushechkin","type":"link","title":"Vladimir Kukushkin","titleInlineContent":[{"text":"Vladimir Kukushkin","type":"text"}]}}}